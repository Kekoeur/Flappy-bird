{"ast":null,"code":"import{bg,fg,bird,pipe}from'./asset';import{height}from'../common/common';import{bg_h,bg_w,fg_h,fg_w,pipe_h,pipe_w,bird_h,bird_w}from'../common/Sprite';//To get sprite properties\nimport{action,observable}from'mobx';var bg1=new bg(guid(),0,height-bg_h);var bg2=new bg(guid(),bg_w,height-bg_h);//Build the moving ground\nvar fg1=new fg(guid(),0,height-fg_h);var fg2=new fg(guid(),fg_w,height-fg_h);export var states={Splash:0,Game:1,Score:2};//Game state\nexport var game=observable({currentstate:0});export var store={bird:new bird(guid(),60,0),fgpos:0,frames:1,bgs:[bg1,bg2],fgs:[fg1,fg2],pipes:observable([]),//initialize with empty pipe\nscore:0};function guid(){function s4(){return Math.floor((1+Math.random())*0x10000).toString(16).substring(1);}return s4()+s4()+'-'+s4()+'-'+s4()+'-'+s4()+'-'+s4()+s4()+s4();}var updateBird=function updateBird(bird){bird.frame+=store.frames%10===0?1:0;bird.frame%=bird.animation.length;//at every 10th, frame change bird frame\nif(game.currentstate===states.Splash){//if splash screen make the bird hover\nbird.cy=height-280+5*Math.cos(store.frames/10);// ~199 - ~201\nbird.rotation=0;}else{bird.velocity+=bird.gravity;bird.cy+=bird.velocity;if(bird.cy>=height-fg_h-10){bird.cy=height-fg_h-10;if(game.currentstate===states.Game){game.currentstate=states.Score;}// sets velocity to jump speed for correct rotation\nbird.velocity=bird._jump;}// when bird lack upward momentum increment the rotation\n// angle\nif(bird.velocity>=bird._jump){bird.frame=1;bird.rotation=Math.min(Math.PI/2,bird.rotation+0.3);}else{bird.rotation=-0.3;}}};var updatePipe=function updatePipe(){if(store.frames%100===0){var _y=height-(pipe_h+fg_h+120+200*Math.random());store.pipes.push(new pipe(guid(),pipe_h,_y,\"S\"),new pipe(guid(),pipe_h,_y+100+pipe_h,\"N\"));}store.pipes.forEach(function(p){var bird=store.bird;var cx=Math.min(Math.max(bird.cx,p.cx),p.cx+pipe_w);var cy=Math.min(Math.max(bird.cy+bird_h/2,p.cy),p.cy+pipe_h);if(bird.cx+bird_w/2>p.cx&&!p.scored){p.scored=true;store.score+=0.5;//2 pipes to score 1 (top and bottom)\n}// closest difference\nvar dx=bird.cx+bird_w/2-cx;var dy=bird.cy+bird_h/2-cy;// vector length\nvar d1=dx*dx+dy*dy;var r=bird.radius*bird.radius;// determine intersection\nif(r>d1){game.currentstate=states.Score;}//Move the pipe towards left\np.cx-=2;//If pipe continue to move out of spaces\nif(p.cx<-pipe_w){store.pipes.splice(0,2);//remove first 2 pipe\n}});};export var birdjump=action(function(bird){bird.velocity=-bird._jump;});export var rungame=action(function(){store.bird=new bird(guid(),60,0);store.fgpos=0;store.frames=1;store.score=0;store.pipes=observable([]);//Initalize to empty empty on game start\ngame.currentstate=states.Game;});//Call to update frame\nexport var updateFrame=action(function(){store.frames++;store.fgpos=(store.fgpos-2)%14;fg1.cx=store.fgpos;//Fg is observing the cx position not fgpos\nfg2.cx=store.fgpos+fg_w;updateBird(store.bird);if(game.currentstate===states.Game){updatePipe();}});","map":{"version":3,"names":["bg","fg","bird","pipe","height","bg_h","bg_w","fg_h","fg_w","pipe_h","pipe_w","bird_h","bird_w","action","observable","bg1","guid","bg2","fg1","fg2","states","Splash","Game","Score","game","currentstate","store","fgpos","frames","bgs","fgs","pipes","score","s4","Math","floor","random","toString","substring","updateBird","frame","animation","length","cy","cos","rotation","velocity","gravity","_jump","min","PI","updatePipe","_y","push","forEach","p","cx","max","scored","dx","dy","d1","r","radius","splice","birdjump","rungame","updateFrame"],"sources":["/opt/lampp/htdocs/Projet/Flappybird-react/src/store/store.js"],"sourcesContent":["import {bg, fg, bird, pipe } from './asset'\nimport { height } from '../common/common';\nimport { bg_h, bg_w, fg_h, fg_w, pipe_h, pipe_w, bird_h, bird_w} from '../common/Sprite'; //To get sprite properties\nimport {action, observable } from 'mobx';\n\nconst bg1 = new bg(guid(), 0, height - bg_h)\nconst bg2 = new bg(guid(), bg_w, height - bg_h)\n\n//Build the moving ground\nconst fg1 = new fg(guid(), 0, height - fg_h )\nconst fg2 = new fg(guid(), fg_w, height - fg_h )\n\nexport const states = {\n   Splash: 0, Game: 1, Score: 2\n}\n\n//Game state\nexport const game = observable({\n    currentstate:0,\n})\n\nexport const store = {\n  bird : new bird(guid(),60,0),\n  fgpos: 0,\n  frames: 1,\n  bgs: [ bg1, bg2 ],\n  fgs: [ fg1, fg2 ],\n  pipes: observable([]), //initialize with empty pipe\n  score: 0,\n}\n\nfunction guid() {\n  function s4() {\n    return Math.floor((1 + Math.random()) * 0x10000)\n      .toString(16)\n      .substring(1);\n  }\n  return s4() + s4() + '-' + s4() + '-' + s4() + '-' +\n    s4() + '-' + s4() + s4() + s4();\n}\n\nconst updateBird = function(bird) {\n  bird.frame += store.frames % 10 === 0 ? 1 : 0;\n  bird.frame %= bird.animation.length; //at every 10th, frame change bird frame\n\n  if (game.currentstate === states.Splash) { //if splash screen make the bird hover\n\n    bird.cy = height - 280 + 5*Math.cos(store.frames/10)  // ~199 - ~201\n    bird.rotation = 0;\n\n  } else {\n\n    bird.velocity += bird.gravity;\n  \tbird.cy += bird.velocity;\n\n    if (bird.cy >= height - fg_h-10) {\n      bird.cy = height - fg_h-10;\n      if (game.currentstate === states.Game) {\n\n            game.currentstate = states.Score;\n\n  \t\t}\n      // sets velocity to jump speed for correct rotation\n      bird.velocity = bird._jump;\n    }\n\n    // when bird lack upward momentum increment the rotation\n    // angle\n    if (bird.velocity >= bird._jump) {\n\n      bird.frame = 1;\n      bird.rotation = Math.min(Math.PI/2, bird.rotation + 0.3);\n\n    } else {\n\n      bird.rotation = -0.3;\n\n    }\n  }\n}\n\nconst updatePipe = function() {\n\n  if (store.frames % 100 === 0) {\n\n    var _y = height - (pipe_h + fg_h +120+200*Math.random());\n    store.pipes.push(\n      new pipe(guid(), pipe_h, _y, \"S\"),\n      new pipe(guid(), pipe_h, _y+100+ pipe_h, \"N\")\n    )\n  }\n\n  store.pipes.forEach( (p) => {\n    const bird = store.bird\n    var cx = Math.min(Math.max(bird.cx  , p.cx), p.cx + pipe_w);\n    var cy = Math.min(Math.max(bird.cy + bird_h/2, p.cy), p.cy + pipe_h);\n\n    if(bird.cx + bird_w/2 > p.cx && !p.scored){\n      p.scored = true;\n      store.score += 0.5; //2 pipes to score 1 (top and bottom)\n    }\n\n    // closest difference\n    var dx = bird.cx + bird_w/2 - cx;\n    var dy = bird.cy + bird_h/2 - cy;\n\n    // vector length\n    var d1 = dx*dx + dy*dy;\n    var r = bird.radius*bird.radius;\n\n    // determine intersection\n    if (r > d1) {\n      game.currentstate = states.Score;\n    }\n    //Move the pipe towards left\n    p.cx -= 2\n    //If pipe continue to move out of spaces\n    if (p.cx < -pipe_w) {\n      store.pipes.splice(0, 2); //remove first 2 pipe\n    }\n\n  })\n}\n\nexport const birdjump =  action(function(bird) {\n\n    bird.velocity = -bird._jump;\n\n})\n\nexport const rungame = action(function() {\n\n    store.bird = new bird(guid(),60,0)\n    store.fgpos = 0\n    store.frames = 1\n    store.score = 0\n    store.pipes = observable([])  //Initalize to empty empty on game start\n\n    game.currentstate= states.Game\n\n\n})\n\n//Call to update frame\nexport const updateFrame = action(function() {\n\n  store.frames++;\n  store.fgpos = (store.fgpos - 2) % 14;\n  fg1.cx = store.fgpos;  //Fg is observing the cx position not fgpos\n  fg2.cx = store.fgpos + fg_w;\n\n  updateBird(store.bird)\n\n  if (  game.currentstate  === states.Game) {\n      updatePipe()\n  }\n\n})\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}